<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultation Journey Analytics</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

    <!-- Prop-Types (Recharts Dependency) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>

    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
<div id="root"></div>

<script type="text/babel">
    const { useState } = React;
    const {
        LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer
    } = window.Recharts;

    // --- Icons ---
    const IconUser = ({ size = 16, className = "" }) =>
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size}
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
             className={className}>
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
        </svg>;

    const IconBot = ({ size = 16, className = "" }) =>
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size}
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
             className={className}>
            <rect x="3" y="11" width="18" height="10" rx="2"/>
            <circle cx="12" cy="5" r="2"/>
            <path d="M12 7v4"/>
            <line x1="8" y1="16" x2="8" y2="16"/>
            <line x1="16" y1="16" x2="16" y2="16"/>
        </svg>;

    const IconPhone = ({ size = 16, className = "" }) =>
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size}
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
             className={className}>
            <path
                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>;

    const IconHome = ({ size = 16, className = "" }) =>
        <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size}
             viewBox="0 0 24 24" fill="none" stroke="currentColor"
             strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"
             className={className}>
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>;

    // --- Mock Data ---
    const trendData = [
        { month: '1월', ARS: 180, ThinQ: 120, Chatbot: 80, Web: 200 },
        { month: '2월', ARS: 210, ThinQ: 130, Chatbot: 90, Web: 210 },
        { month: '3월', ARS: 170, ThinQ: 125, Chatbot: 100, Web: 220 },
        { month: '4월', ARS: 230, ThinQ: 140, Chatbot: 110, Web: 250 },
        { month: '5월', ARS: 200, ThinQ: 150, Chatbot: 130, Web: 240 },
        { month: '6월', ARS: 560, ThinQ: 200, Chatbot: 180, Web: 300 },
        { month: '7월', ARS: 635, ThinQ: 220, Chatbot: 210, Web: 320 },
        { month: '8월', ARS: 540, ThinQ: 210, Chatbot: 200, Web: 310 },
        { month: '9월', ARS: 206, ThinQ: 160, Chatbot: 150, Web: 280 },
        { month: '10월', ARS: 240, ThinQ: 170, Chatbot: 160, Web: 290 }
    ];

    // --- Colors ---
    const COLORS = {
        ARS: "#A50034",
        Chatbot: "#4B5563",
        ThinQ: "#10B981",
        Web: "#6B7280",
        Sankey: {
            inbound: "#9CA3AF",
            voiceBot: "#A50034",
            visibleArs: "#EF4444",
            touchArs: "#757575",
            direct: "#15803D",
            selfAttempt: "#DC2626",
            agentAttempt: "#166534",
            drop: "#D1D5DB",
            selfResolved: "#B91C1C",
            agentResolved: "#14532D",
            pathBase: "#FECACA",
            pathAgent: "#BBF7D0",
            pathDrop: "#E5E7EB"
        }
    };

    // --- Components ---

    const SummaryCard = ({ title, value, change, icon: Icon, color }) => (
        <div
            className="bg-white rounded-lg shadow-sm border border-gray-200 p-4 flex flex-col items-center justify-center h-28 relative overflow-hidden">
            <div className="absolute top-0 left-0 w-1 h-full" style={{ backgroundColor: color }}></div>
            <div className="flex items-center gap-2 mb-2">
                <div className="p-1.5 rounded-full bg-gray-100 text-gray-600">
                    <Icon size={16}/>
                </div>
                <span className="text-gray-500 text-sm font-bold">{title}</span>
            </div>
            <div className="text-xl font-bold text-gray-800">{value}</div>
            <div
                className={`text-xs mt-1 font-medium flex items-center ${change.includes('▼') ? 'text-red-500' : 'text-green-500'}`}>
                {change}
            </div>
        </div>
    );

    // 줄바꿈을 prop 두 개로 분리해서 확실히 처리
    const KPICard = ({ title, line1, line2, subText, type = 'default' }) => (
        <div className="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200 h-full">
            <div
                className={`px-4 py-2 text-sm font-bold text-center ${
                    type === 'red' ? 'bg-[#A50034] text-white' : 'bg-gray-100 text-gray-700'
                }`}
            >
                {title}
            </div>
            <div className="p-4 flex flex-col items-center justify-center h-24">
                <div className="text-xl font-bold text-gray-800 text-center leading-tight">
                    {line1 && <div>{line1}</div>}
                    {line2 && <div className="mt-1">{line2}</div>}
                </div>
                {subText && <div className="text-xs text-gray-500 mt-1 text-center">{subText}</div>}
            </div>
        </div>
    );

    // --- Advanced Sankey Diagram (SVG) ---
    const AdvancedSankey = () => {
        const w = 1000;
        const h = 520;  // 원본 비율 근처

        const col1 = 50;
        const col2 = 280;
        const col3 = 600;
        const col4 = 900;

        const scale = 400 / 1245621;

        const n_Total = { x: col1, y: 80, val: 1245621, h: 1245621 * scale, color: COLORS.Sankey.inbound, label: "콜 인입", sub: "1,245,621" };

        const n_Voice = { x: col2, y: 80, val: 373695, h: 373695 * scale, color: COLORS.Sankey.voiceBot, label: "보이스봇", sub: "30.0%" };
        const n_Vis   = { x: col2, y: 200, val: 341477, h: 341477 * scale, color: COLORS.Sankey.visibleArs, label: "보이는ARS", sub: "27.4%" };
        const n_Touch = { x: col2, y: 320, val: 370564, h: 370564 * scale, color: COLORS.Sankey.touchArs, label: "누르는ARS", sub: "29.7%" };
        const n_Direct= { x: col2, y: 430, val: 159885, h: 159885 * scale, color: COLORS.Sankey.direct, label: "직접연결", sub: "12.8%" };

        const y_Voice_Base = 80;
        const n_Voice_Self = { x: col3, y: y_Voice_Base, h: (173367 * scale), color: COLORS.Sankey.selfAttempt, label: "무인시도", sub: "173K" };
        const n_Voice_Agnt = { x: col3, y: y_Voice_Base + 70, h: (93129 * scale), color: COLORS.Sankey.agentAttempt, label: "상담연결", sub: "93K" };
        const n_Voice_Drop = { x: col3, y: y_Voice_Base + 140, h: (107199 * scale), color: COLORS.Sankey.drop, label: "끊음", sub: "107K" };

        const y_Vis_Base = 220;
        const n_Vis_Self = { x: col3, y: y_Vis_Base, h: (130567 * scale), color: COLORS.Sankey.selfAttempt, label: "무인시도", sub: "130K" };
        const n_Vis_Agnt = { x: col3, y: y_Vis_Base + 70, h: (153772 * scale), color: COLORS.Sankey.agentAttempt, label: "상담연결", sub: "153K" };
        const n_Vis_Drop = { x: col3, y: y_Vis_Base + 150, h: (57138 * scale), color: COLORS.Sankey.drop, label: "끊음", sub: "57K" };

        const y_Touch_Base = 360;
        const n_Touch_Self = { x: col3, y: y_Touch_Base, h: (26805 * scale), color: COLORS.Sankey.selfAttempt, label: "무인시도", sub: "26K" };
        const n_Touch_Agnt = { x: col3, y: y_Touch_Base + 50, h: (173840 * scale), color: COLORS.Sankey.agentAttempt, label: "상담연결", sub: "173K" };
        const n_Touch_Drop = { x: col3, y: y_Touch_Base + 140, h: (169919 * scale), color: COLORS.Sankey.drop, label: "끊음", sub: "169K" };

        const n_Direct_Agnt = { x: col3, y: 460, h: (159885 * scale), color: COLORS.Sankey.direct, label: "직접연결", sub: "159K" };

        const y_Res_Top = 80;
        const n_Res_Voice_Ok = { x: col4, y: y_Res_Top, h: (80073 * scale), color: COLORS.Sankey.selfResolved, label: "무인해결", sub: "46%" };
        const n_Res_Voice_Ag = { x: col4, y: y_Res_Top + 40, h: (45749 * scale), color: COLORS.Sankey.agentResolved, label: "상담연결", sub: "26%" };

        const y_Res_Mid = 220;
        const n_Res_Vis_Ok = { x: col4, y: y_Res_Mid, h: (93225 * scale), color: COLORS.Sankey.selfResolved, label: "무인해결", sub: "71%" };
        const n_Res_Vis_Ag = { x: col4, y: y_Res_Mid + 40, h: (11238 * scale), color: COLORS.Sankey.agentResolved, label: "상담연결", sub: "8%" };

        const y_Res_Bot = 360;
        const n_Res_Touch_Ok = { x: col4, y: y_Res_Bot, h: (6855 * scale), color: COLORS.Sankey.selfResolved, label: "무인해결", sub: "25%" };

        const drawLink = (src, dst, color, opacity = 0.3) => {
            const c1 = src.x + 80;
            const c2 = dst.x - 80;
            const srcY = src.y + src.h / 2;
            const dstY = dst.y + dst.h / 2;
            const thick = Math.min(src.h, dst.h) * 0.8;

            return (
                <path
                    d={`M ${src.x + 20} ${srcY} C ${c1} ${srcY}, ${c2} ${dstY}, ${dst.x} ${dstY}`}
                    stroke={color}
                    strokeWidth={thick}
                    fill="none"
                    opacity={opacity}
                    className="hover:opacity-60 transition-opacity duration-300"
                />
            );
        };

        const renderNode = (n) => (
            <g>
                <rect x={n.x} y={n.y} width={20} height={n.h} fill={n.color} rx={4}/>
                <text x={n.x + 25} y={n.y + 15} fontSize="12" fontWeight="bold" fill="#374151">{n.label}</text>
                <text x={n.x + 25} y={n.y + 30} fontSize="11" fill="#6B7280">{n.sub}</text>
            </g>
        );

        return (
            <div className="w-full overflow-visible bg-white p-4">
                <svg
                    className="block mx-auto"
                    width={w}
                    height={h}
                    viewBox={`0 0 ${w} ${h}`}
                >
                    <text x={col1} y="40" fontSize="14" fontWeight="bold" textAnchor="start">ARS별 인입</text>
                    <text x={col2} y="40" fontSize="14" fontWeight="bold" textAnchor="start">ARS 선택</text>
                    <text x={col3} y="40" fontSize="14" fontWeight="bold" textAnchor="start">상담 시도</text>
                    <text x={col4} y="40" fontSize="14" fontWeight="bold" textAnchor="start">문제 해결 여부</text>

                    {drawLink(n_Total, n_Voice, COLORS.Sankey.pathBase)}
                    {drawLink(n_Total, n_Vis, COLORS.Sankey.pathBase)}
                    {drawLink(n_Total, n_Touch, COLORS.Sankey.pathBase)}
                    {drawLink(n_Total, n_Direct, COLORS.Sankey.pathAgent)}

                    {drawLink(n_Voice, n_Voice_Self, COLORS.Sankey.pathBase)}
                    {drawLink(n_Voice, n_Voice_Agnt, COLORS.Sankey.pathAgent)}
                    {drawLink(n_Voice, n_Voice_Drop, COLORS.Sankey.pathDrop, 0.5)}

                    {drawLink(n_Vis, n_Vis_Self, COLORS.Sankey.pathBase)}
                    {drawLink(n_Vis, n_Vis_Agnt, COLORS.Sankey.pathAgent)}
                    {drawLink(n_Vis, n_Vis_Drop, COLORS.Sankey.pathDrop, 0.5)}

                    {drawLink(n_Touch, n_Touch_Self, COLORS.Sankey.pathBase)}
                    {drawLink(n_Touch, n_Touch_Agnt, COLORS.Sankey.pathAgent)}
                    {drawLink(n_Touch, n_Touch_Drop, COLORS.Sankey.pathDrop, 0.5)}

                    {drawLink(n_Direct, n_Direct_Agnt, COLORS.Sankey.pathAgent)}

                    {drawLink(n_Voice_Self, n_Res_Voice_Ok, COLORS.Sankey.pathBase)}
                    {drawLink(n_Voice_Self, n_Res_Voice_Ag, COLORS.Sankey.pathDrop)}

                    {drawLink(n_Vis_Self, n_Res_Vis_Ok, COLORS.Sankey.pathBase)}
                    {drawLink(n_Vis_Self, n_Res_Vis_Ag, COLORS.Sankey.pathDrop)}

                    {drawLink(n_Touch_Self, n_Res_Touch_Ok, COLORS.Sankey.pathBase)}

                    {renderNode(n_Total)}

                    {renderNode(n_Voice)}
                    {renderNode(n_Vis)}
                    {renderNode(n_Touch)}
                    {renderNode(n_Direct)}

                    {renderNode(n_Voice_Self)}
                    {renderNode(n_Voice_Agnt)}
                    {renderNode(n_Voice_Drop)}

                    {renderNode(n_Vis_Self)}
                    {renderNode(n_Vis_Agnt)}
                    {renderNode(n_Vis_Drop)}

                    {renderNode(n_Touch_Self)}
                    {renderNode(n_Touch_Agnt)}
                    {renderNode(n_Touch_Drop)}
                    {renderNode(n_Direct_Agnt)}

                    {renderNode(n_Res_Voice_Ok)}
                    {renderNode(n_Res_Voice_Ag)}
                    {renderNode(n_Res_Vis_Ok)}
                    {renderNode(n_Res_Vis_Ag)}
                    {renderNode(n_Res_Touch_Ok)}
                </svg>

                <div className="mt-4 flex justify-between bg-gray-50 p-3 rounded border border-gray-200 text-sm">
                    <div className="flex gap-4">
                        <span className="text-red-700 font-bold">57.4% 무인대상</span>
                        <span className="text-gray-400">|</span>
                        <span>보이스봇 + 보이는ARS</span>
                    </div>
                    <div className="flex gap-4">
                        <span className="text-red-700 font-bold">42.5% 무인시도</span>
                        <span className="text-gray-400">|</span>
                        <span>전체 콜 比 26.6%</span>
                    </div>
                    <div className="flex gap-4">
                        <span className="text-red-700 font-bold">57.0% 무인해결</span>
                        <span className="text-gray-400">|</span>
                        <span>성공률 14.5%</span>
                    </div>
                </div>
            </div>
        );
    };

    const DashboardApp = () => {
        const [period, setPeriod] = useState('월별');

        return (
            <div className="min-h-screen bg-gray-100 p-6 font-sans">
                <div className="flex justify-between items-end mb-6">
                    <div>
                        <h1 className="text-2xl font-bold text-gray-900">상담 여정 통합 대시보드</h1>
                        <p className="text-sm text-gray-500 mt-1">채널별 인입 현황 및 ARS 상세 Call Flow 분석</p>
                    </div>
                    <div className="flex bg-white rounded-lg shadow-sm border border-gray-200 p-1">
                        {['연도별', '월별', '주별', '일별'].map(p => (
                            <button
                                key={p}
                                onClick={() => setPeriod(p)}
                                className={`px-4 py-1.5 rounded text-sm font-bold transition-colors ${
                                    period === p ? 'bg-[#A50034] text-white' : 'text-gray-500 hover:bg-gray-50'
                                }`}
                            >
                                {p}
                            </button>
                        ))}
                    </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div className="flex flex-col gap-6">
                        <div className="grid grid-cols-2 gap-3">
                            <SummaryCard title="ARS" value="653,236" change="557K ▼" icon={IconPhone} color={COLORS.ARS}/>
                            <SummaryCard title="챗봇" value="423,420" change="337K ▼" icon={IconBot} color={COLORS.Chatbot}/>
                            <SummaryCard title="ThinQ" value="206,110" change="334K ▼" icon={IconHome} color={COLORS.ThinQ}/>
                            <SummaryCard title="홈페이지" value="952,445" change="248K ▼" icon={IconUser} color={COLORS.Web}/>
                        </div>

                        <div
                            className="bg-white rounded-lg shadow-sm border border-gray-200 p-5 flex-1 min-h-[300px]">
                            <h3 className="text-gray-700 font-bold mb-4 flex items-center gap-2">
                                <span className="w-1 h-4 bg-gray-400"></span>
                                [ 기간별 채널별 유입 Trend ]
                            </h3>
                            <div className="h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={trendData}>
                                        <CartesianGrid strokeDasharray="3 3" vertical={false}/>
                                        <XAxis dataKey="month" tick={{ fontSize: 12 }}/>
                                        <YAxis hide/>
                                        <Tooltip/>
                                        <Legend iconType="circle"/>
                                        <Line type="monotone" dataKey="ARS" stroke={COLORS.ARS} strokeWidth={2}
                                              dot={{ r: 3 }}/>
                                        <Line type="monotone" dataKey="ThinQ" stroke={COLORS.ThinQ} strokeWidth={2}
                                              dot={{ r: 3 }}/>
                                        <Line type="monotone" dataKey="Chatbot" stroke={COLORS.Chatbot} strokeWidth={2}
                                              dot={{ r: 3 }}/>
                                        <Line type="monotone" dataKey="Web" stroke={COLORS.Web} strokeWidth={2}
                                              dot={{ r: 3 }}/>
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    </div>

                    <div className="lg:col-span-2 flex flex-col gap-6">
                        <div className="grid grid-cols-4 gap-4 h-32">
                            <KPICard
                                title="전체 인입"
                                line1="85,632 건"
                                line2="2.6% ▲"
                                type="red"
                            />
                            <KPICard
                                title="무인상담"
                                line1="21,901 건"
                                line2="40.9%"
                            />
                            <KPICard
                                title="무인처리 Top3"
                                line1=""
                                subText="① 출장접수 49.3% ② 컨텐츠제공 23.8% ③ 센터예약 5.6%"
                            />
                            <KPICard
                                title="유인상담"
                                line1="24,565 건"
                                line2="52.9%"
                                type="red"
                            />
                        </div>

                        <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-0">
                            <div className="p-4 border-b border-gray-100 flex justify-between items-center">
                                <h3 className="font-bold text-gray-800 text-lg">【 ARS Call Flow 상세 분석 】</h3>
                                <span className="text-xs text-gray-400">※ Data 기준: '25년 10월</span>
                            </div>

                            <div className="overflow-x-auto">
                                <AdvancedSankey/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<DashboardApp/>);
</script>
</body>
</html>
